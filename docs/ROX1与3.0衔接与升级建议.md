# ROX 1.0 与 3.0 衔接说明与后续升级建议

## 一、ROX 3.0 在界面中的定位与衔接

**定位**

- **1.0**：主界面，承担市场看板、宏观、每周推荐、个股诊断、知识库、交易、社区、系统等模块。
- **3.0**：专业版，侧重 K 线、分时、盘口、自选股、涨跌排行、沪深 A 股列表等深度看盘与操作。

两套 UI 保持现有设计不变，通过**同一套登录态**衔接，避免重复登录。

**衔接方式**

1. 在 1.0 登录后，token 写入 `localStorage`。
2. 从 1.0 点击「ROX 3.0」进入专业版后，所有请求（含自选股）由 `api-client.js` 自动携带该 token。
3. 因此**只需在 1.0 登录一次**，进入 3.0 后无需再次登录。

若在 3.0 仍出现「请先登录」，多为未在 1.0 先登录或 token 已过期，在 1.0 重新登录即可。

---

## 二、3.0 股票列表与通达信的差异

**差异原因**

- 通达信为本地/专用行情，可全市场罗列。
- 当前 ROX 为接口拉取，全量一次加载会较慢。

**当前方案（折中）**

- 3.0 默认展示约 **500 只**（按涨跌幅排序），接口上限 **2000 条**。
- 在「比之前只显示几只」明显改善的前提下，保证列表加载流畅。

**若需更接近「全量罗列」**

可在现有基础上增加：

- **分页**：例如每页 500 条，用户翻页加载；
- **虚拟滚动**：只渲染可见区域，支持 5000+ 只股票而不会一次请求/渲染过多。

届时可在「沪深 A 股」Tab 上增加说明：「默认 500 条，按涨跌幅排序；完整列表可用搜索或分页」。

---

## 三、已实现的升级点

| 方向 | 状态 | 说明 |
|------|------|------|
| **统一 token 刷新** | ✅ 已实现 | 1.0 / 3.0 在请求前检查 token 是否 5 分钟内过期，若是则自动调用 `POST /token/refresh` 换新 token，避免多标签 401。 |
| **1.0 → 3.0 带上下文** | ✅ 已实现 | 从 1.0 点击「ROX 3.0」时，若有当前诊断股票则跳转 `/pro?code=xxx&name=xxx`，3.0 加载后直接打开该只 K 线/分时并清理 URL 参数。 |
| **自选股** | ✅ 已一致 | 1.0 与 3.0 共用同一套自选股接口与登录态，任一侧添加/删除即一致。 |
| **沪深 A 股分页 + 说明** | ✅ 已实现 | 接口支持 `offset`/`limit` 与 `total`；3.0 默认 500 条，Tab 上说明「默认 500 条，按涨跌幅排序；完整列表可用下方「加载更多」或搜索」，并提供「加载更多」分页。 |

## 四、后续可考虑的升级点

| 方向 | 说明 |
|------|------|
| **多设备/云端同步自选股** | 若未来需要多设备同步，再考虑账号与云端同步。 |

---

## 五、如需落地方案

若需要将「分页」或「虚拟滚动」落到具体实现，可在此基础上进一步给出：

- 接口参数设计（如 `page`、`page_size` 或 `offset`/`limit`）；
- 前端调用方式与列表组件的改造方式（含示例代码位置）。

以上内容可直接用于内部说明或对外回复，按需微调表述即可。
