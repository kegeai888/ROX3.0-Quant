# 将 Rox Quant 转换为通达信 (TDX) 插件的技术方案

## 1. 方案概述

将 Rox Quant 改造为通达信插件是**完全可行**的，且是量化领域常用的“外挂”模式。

由于通达信（TDX）是基于 Windows C++ 的封闭系统，而 Rox Quant 是基于 Python/Web 的现代系统，我们不能直接将 Rox 的界面“塞进”通达信的菜单里，但我们可以通过 **DLL 桥接技术** 将 Rox 的强大算力（AI、回测、策略）引入通达信的公式系统中。

### 核心架构：Sidecar 模式

```
[ 通达信终端 (TDX) ]  <--->  [ 桥接 DLL (C++) ]  <--->  [ Rox Quant 服务 (Python) ]
      |                           |                           |
  画线/选股公式               PluginTCalcFunc              FastAPI 接口
      |                           |                           |
   显示结果                    数据转发                    AI运算/策略逻辑
```

## 2. 详细实现步骤

### 第一步：保持 Rox 服务运行
Rox Quant 继续作为本地服务运行（`http://127.0.0.1:8000`）。它负责处理复杂的计算逻辑，如：
- AI 趋势预测
- 实时多因子打分
- 知识库查询

### 第二步：开发 C++ 桥接插件 (已为您生成原型)
我们需要一个轻量级的 C++ DLL，它的唯一职责就是：
1. 接收通达信传来的实时行情数据（Code, Price, Vol）。
2. 通过 HTTP/Socket 发送给 Rox 服务。
3. 接收 Rox 返回的信号（买入/卖出/观望）。
4. 将信号返回给通达信，用于在 K 线图上画箭头或作为选股条件。

**已生成的文件：**
- `tdx_bridge/TdxPlugin.h`: 通达信标准接口定义。
- `tdx_bridge/main.cpp`: 实现了 HTTP 通信的 DLL 源码。

### 第三步：配置通达信
1. 将编译好的 `RoxBridge.dll` 放入通达信目录的 `T0002/dlls/` 文件夹。
2. 在通达信“功能” -> “公式系统” -> “公式管理器” -> “DLL函数”中配置：
   - 第 1 号 DLL 绑定 `RoxBridge.dll`。

### 第四步：编写通达信公式
在通达信中新建一个“技术指标公式”：

```
{Rox AI 指标}
{调用 DLL 1 的第 1 号函数，传入收盘价和成交量}
AI_SIGNAL: TDXDLL1(1, CLOSE, VOL, 0);

{根据信号画图标}
DRAWICON(AI_SIGNAL=1, LOW, 1); {买入信号画红箭头}
DRAWICON(AI_SIGNAL=-1, HIGH, 2); {卖出信号画绿箭头}
```

## 3. 优势与局限

**优势：**
- **算力无限**：突破了通达信公式语言的限制，可以使用 Python 的 sklearn, pytorch, pandas 等库。
- **数据融合**：可以在 Python 端融合另类数据（新闻情绪、宏观数据）来辅助通达信决策。
- **无需重写**：不需要用 C++ 重写现有的 Python 策略。

**局限：**
- **部署复杂**：用户需要同时运行 Rox 服务和通达信。
- **通信延迟**：HTTP 通信有毫秒级延迟（但在日线/分钟线级别完全可忽略）。

## 4. 下一步行动建议

1. **编译 DLL**：使用 Visual Studio (Windows) 编译 `tdx_bridge` 目录下的代码生成 DLL。
2. **测试连接**：启动 Rox (`python main.py`)，然后在通达信中加载公式，观察控制台是否有数据流入。
